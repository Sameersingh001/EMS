<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Complaints</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-pink-200 via-purple-200 to-indigo-300 font-sans z-index:50 min-h-screen antialiased">

    <header class="bg-indigo-700 text-white py-4 px-6 shadow-md fixed top-0 left-0 z-50 w-full">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-sm sm:text-2xl font-bold tracking-wide">Admin Dashboard</h1>
            <div class="flex flex-row gap-5 ">
                <a href="/admin">
                    <button class="w-full py-2 px-4 bg-blue-500 text-white text-sm font-medium rounded-lg hover:bg-blue-600 transition duration-200">Home</button>
                </a>
                <a href="/admin/all-taks/<%= admin.id %>">
                    <button class="w-full py-2 px-4 bg-blue-500 text-white text-sm font-medium rounded-lg hover:bg-blue-600 transition duration-200">All Tasks</button>
                </a>
                <a href="/logout/<%= admin.id %>">
                    <button class="w-full py-2 px-4 bg-red-500 text-white text-sm font-medium rounded-lg hover:bg-red-600 transition duration-200">Logout</button>
                </a>
            </div>
        </div>
    </header>



  <div class="max-w-8xl mx-auto">
    <h1 class="text-3xl font-extrabold text-gray-900 mb-6 tracking-tight mt-5 ml-5">All Complaints</h1>

    <!-- Filter Form (only by status) -->
    <form method="GET" action="/admin/filter" class=" mb-6 bg-white p-4 gap-5 rounded-xl shadow-md flex sm:flex-row justify-center">
      <select name="status" class="sm:px-20 px-10 border border-gray-300 rounded-lg transition">
        <option value="">All Statuses</option>
        <option value="Pending" <%= data.status === 'Pending' ? 'selected' : '' %>>Pending</option>
        <option value="In Progress" <%= data.status === 'In Progress' ? 'selected' : '' %>>In Progress</option>
        <option value="Resolved" <%= data.status === 'Resolved' ? 'selected' : '' %>>Resolved</option>
      </select>
      <button type="submit" class="bg-blue-600 sm:px-10 px-5 text-white py-2 rounded-lg hover:bg-blue-700 transition-shadow shadow-md hover:shadow-lg">Apply Filter</button>
    </form>

    <% if (data.length === 0) { %>
      <p class="text-gray-500 text-lg italic">No complaints found.</p>
    <% } else { %>

      <!-- TABLE for Small Screens and Up -->
      <div class="hidden sm:block overflow-x-auto bg-white rounded-xl shadow-lg ring-1 ring-gray-200">
        <table class="w-full divide-y divide-gray-200">
          <thead class="bg-gray-100">
            <tr>
              <th class="p-4 text-left text-sm font-semibold text-gray-900"># Employee</th>
              <th class="p-4 text-left text-sm font-semibold text-gray-900"># Subject</th>
              <th class="p-4 text-left text-sm font-semibold text-gray-900"># Type</th>
              <th class="p-4 text-left text-sm font-semibold text-gray-900"># Description</th>
              <th class="p-4 text-left text-sm font-semibold text-gray-900"># Status</th>
              <th class="p-2 text-left text-sm font-semibold text-gray-900"># Priority</th>
              <th class="p-4 text-left text-sm font-semibold text-gray-900"># Created At</th>
              <th class="p-4 text-left text-sm font-semibold text-gray-900"># Admin Response</th>
              <th class="p-4 text-left text-sm font-semibold text-gray-900"># Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <% data.forEach((c, index) => { %>
              <tr class="<%= index % 2 === 0 ? 'bg-white' : 'bg-gray-200' %> hover:bg-gray-50 transition-colors">
                <td class="p-4 font-medium text-gray-900"><%=c.employeeId || "Unknown" %> <span class="text-xs text-gray-500">(<%= c.employeeId?._id || "N/A" %>)</span></td>
                <td class="p-4 text-gray-700 break-words"><%= c.subject %></td>
                <td class="p-4 text-gray-700"><%= c.type %></td>
                <td class="p-4 text-gray-700"><%= c.description %></td>
                <td class="p-4">
                  <span class="inline-flex px-6 py-1 rounded-full text-xs font-medium text-white
                    <%= c.status === 'Pending' ? 'bg-yellow-400' : '' %>
                    <%= c.status === 'In Progress' ? 'bg-blue-500' : '' %>
                    <%= c.status === 'Resolved' ? 'bg-green-600' : '' %>">
                    <%= c.status %>
                  </span>
                </td>
                <td class="p-4 text-gray-700"><%= c.priority %></td>
                <td class="p-4 text-gray-700 text-sm"><%= new Date(c.createdAt).toLocaleString() %></td>
                <td class="p-4 text-gray-700 break-words max-w-xs"><%= c.adminResponse || "Not responded" %></td>
                <td class="p-4 space-y-3">
                  <form action="/admin/complaints/update/<%= c._id %>" method="POST" class="space-y-3">
                    <select name="status" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                      <option value="Pending" <%= c.status === 'Pending' ? 'selected' : '' %>>Pending</option>
                      <option value="In Progress" <%= c.status === 'In Progress' ? 'selected' : '' %>>In Progress</option>
                      <option value="Resolved" <%= c.status === 'Resolved' ? 'selected' : '' %>>Resolved</option>
                    </select>
                    <textarea name="adminResponse" rows="3" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"><%= c.adminResponse %></textarea>
                    <button class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-shadow shadow-md hover:shadow-lg">Update</button>
                  </form>
                  <!-- Delete Button -->
                  <form action="/admin/complaints/delete/<%= c._id %>" method="POST">
                    <button type="submit" class="w-full bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-shadow shadow-md hover:shadow-lg">Delete</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <!-- CARDS for Mobile -->
      <div class="block sm:hidden space-y-6">
        <% data.forEach(c => { %>
          <div class="bg-white shadow-md rounded-xl p-5 hover:shadow-xl transition-shadow duration-300 transform hover:scale-105">
            <h1 class="font-bold ">Complaint</h1>
            <p class="text-sm text-gray-500 mb-3">ID: <%= c.employeeId?._id || "N/A" %></p>

            <div class="space-y-2 text-gray-700">
              <p><span class="font-semibold text-gray-900">Subject:</span> <%= c.subject %></p>
              <p><span class="font-semibold text-gray-900">Type:</span> <%= c.type %></p>
                              <details class="mt-4">
                  <summary
                  class="cursor-pointer font-semibold text-md text-gray-900 hover:text-gray-700 transition-colors">
                  Description
                </summary>
                <div class="mt-2 p-4 bg-gray-50 rounded-lg border border-gray-200 text-gray-800 break-words whitespace-pre-line max-h-64 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-100">
                <% if (c.description && c.description.trim() !=='' ) { %>
                  <%= c.description %>
                  <% } else { %>
                    <span class="italic text-gray-500">Description not Provided</span>
                  <% } %>
                </div>
                  </details>
              <p>
                <span class="font-semibold text-gray-900">Status:</span> 
                <span class="inline-flex px-3 py-1 rounded-full text-xs font-medium text-white
                  <%= c.status === 'Pending' ? 'bg-yellow-400' : '' %>
                  <%= c.status === 'In Progress' ? 'bg-blue-500' : '' %>
                  <%= c.status === 'Resolved' ? 'bg-green-600' : '' %>">
                  <%= c.status %>
                </span>
              </p>
              <p><span class="font-semibold text-gray-900">Priority:</span> <%= c.priority %></p>
              <p class="text-sm text-gray-500"><span class="font-semibold text-gray-900">Created:</span> <%= new Date(c.createdAt).toLocaleString() %></p>
              <details class="mt-4">
                  <summary
                  class="cursor-pointer font-semibold text-md text-gray-900 hover:text-gray-700 transition-colors">
                  My Response
                </summary>
                <div
                class="mt-2 p-4 bg-gray-50 rounded-lg border border-gray-200 text-gray-800 break-words whitespace-pre-line max-h-64 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-100">
                <% if (c.adminResponse && c.adminResponse.trim() !=='' ) { %>
                  <%= c.adminResponse %>
                  <% } else { %>
                    <span class="italic text-gray-500">No response yet</span>
                          <% } %>
                    </div>
                  </details>
            </div>

            <!-- Update Form -->
            <form action="/admin/complaints/update/<%= c._id %>" method="POST" class="space-y-3 mt-4">
              <select name="status" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                <option value="Pending" <%= c.status === 'Pending' ? 'selected' : '' %>>Pending</option>
                <option value="In Progress" <%= c.status === 'In Progress' ? 'selected' : '' %>>In Progress</option>
                <option value="Resolved" <%= c.status === 'Resolved' ? 'selected' : '' %>>Resolved</option>
              </select>
              <textarea name="adminResponse" rows="3" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"><%= c.adminResponse %></textarea>
              <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-shadow shadow-md hover:shadow-lg">Update</button>
            </form>

            <!-- Delete Button -->
            <form action="/admin/complaints/delete/<%= c._id %>" method="POST" class="mt-3">
              <button type="submit" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition-shadow shadow-md hover:shadow-lg" onclick="return confirm('Are you sure you want to delete this task?')" >Delete</button>
            </form>
          </div>
        <% }) %>
      </div>

    <% } %>
  </div>
</body>
</html>
